<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns='http://www.w3.org/1999/xhtml'>

<head>
<title>Compile Time Commands</title>
<meta name="generator" content="Halibut version 1.0 (NSIS Custom Build) xhtml-backend" />
<link rel="stylesheet" href="style.css" type='text/css' />
</head>

<body>
<p><a href='Chapter4.html'>Previous</a> | <a href='Contents.html'>Contents</a> | <a href='AppendixA.html'>Next</a></p>
<ul>
<li><a class="btitle" href="Chapter5.html#"><b>Chapter 5: </b>Compile Time Commands</a></li>
<ul>
<li><a href="Chapter5.html#5.1">Compiler Utility Commands</a></li>
<ul>
<li><a href="Chapter5.html#5.1.1">!include</a></li>
<li><a href="Chapter5.html#5.1.2">!addincludedir</a></li>
<li><a href="Chapter5.html#5.1.3">!addplugindir</a></li>
<li><a href="Chapter5.html#5.1.4">!cd</a></li>
<li><a href="Chapter5.html#5.1.5">!echo</a></li>
<li><a href="Chapter5.html#5.1.6">!error</a></li>
<li><a href="Chapter5.html#5.1.7">!execute</a></li>
<li><a href="Chapter5.html#5.1.8">!packhdr</a></li>
<li><a href="Chapter5.html#5.1.9">!system</a></li>
<li><a href="Chapter5.html#5.1.10">!warning</a></li>
<li><a href="Chapter5.html#5.1.11">!verbose</a></li>
</ul>
<li><a href="Chapter5.html#5.2">Predefines</a></li>
<ul>
<li><a href="Chapter5.html#5.2.1">${__FILE__}</a></li>
<li><a href="Chapter5.html#5.2.2">${__LINE__}</a></li>
<li><a href="Chapter5.html#5.2.3">${__DATE__}</a></li>
<li><a href="Chapter5.html#5.2.4">${__TIME__}</a></li>
<li><a href="Chapter5.html#5.2.5">${__TIMESTAMP__}</a></li>
</ul>
<li><a href="Chapter5.html#5.3">Read enviroment variables</a></li>
<ul>
<li><a href="Chapter5.html#5.3.1">$%envVarName%</a></li>
</ul>
<li><a href="Chapter5.html#5.4">Conditional Compilation</a></li>
<ul>
<li><a href="Chapter5.html#5.4.1">!define</a></li>
<li><a href="Chapter5.html#5.4.2">!undef</a></li>
<li><a href="Chapter5.html#5.4.3">!ifdef</a></li>
<li><a href="Chapter5.html#5.4.4">!ifndef</a></li>
<li><a href="Chapter5.html#5.4.5">!ifmacrodef</a></li>
<li><a href="Chapter5.html#5.4.6">!ifmacrondef</a></li>
<li><a href="Chapter5.html#5.4.7">!else</a></li>
<li><a href="Chapter5.html#5.4.8">!endif</a></li>
<li><a href="Chapter5.html#5.4.9">!insertmacro</a></li>
<li><a href="Chapter5.html#5.4.10">!macro</a></li>
<li><a href="Chapter5.html#5.4.11">!macroend</a></li>
</ul>
</ul>
</ul>
<a name="5"></a><h1>Chapter 5: Compile Time Commands</h1>
<a name="5.1"></a><h2>5.1 Compiler Utility Commands</h2>

<p>These commands are similar to the C preprocessor in terms of purpose and functionality. They allow file inclusion, conditional compilation, executable header packing, and processes execution during the build process. Note: none of these commands allow use of variables.</p>
<a name="5.1.1"></a><h3>5.1.1 !include</h3>
<pre>file
</pre>

<p>This command will include 'file' as if it was part of the original script. Note that if a file is included in another directory, the current directory is still where the script was compiled from (not where the included file resides). If the compiler can't find the file it will look for it in every include directory. See !addincludedir for more information.</p>
<pre>!include WinMessages.nsh
!include Library.nsh
!include MyConfig.nsh
!include ..\MyConfig.nsh
</pre>
<a name="5.1.2"></a><h3>5.1.2 !addincludedir</h3>
<pre>directory
</pre>

<p>Adds another include directory to the include directories list. This list is searched when !include is used. This list's initial value is ${NSISDIR}\Include alone.</p>
<pre>!addincludedir ..\include
!include something.nsh
</pre>
<a name="5.1.3"></a><h3>5.1.3 !addplugindir</h3>
<pre>directory
</pre>

<p>Causes the NSIS compiler to scan the given directory for Plugin DLLs.</p>
<pre>!addplugindir myplugin
MyPlugin::SomeFunction
</pre>
<a name="5.1.4"></a><h3>5.1.4 !cd</h3>
<pre>new_path
</pre>

<p>This command will change the compiler to the new directory, new_path. new_path can be relative or absolute.</p>
<pre>!cd ..\more-scripts\new
</pre>
<a name="5.1.5"></a><h3>5.1.5 !echo</h3>
<pre>message
</pre>

<p>This command will echo a message to the user compiling the script.</p>
<pre>!echo &quot;hello world&quot;
</pre>
<a name="5.1.6"></a><h3>5.1.6 !error</h3>
<pre>[message]
</pre>

<p>This command will issue an error to the script compiler and will stop execution of the script. You can also add a message to this error.</p>
<pre>!ifdef VERSION &amp; NOVERSION
  !error &quot;both VERSION and NOVERSION are defined&quot;
!endif
</pre>
<a name="5.1.7"></a><h3>5.1.7 !execute</h3>
<pre>command
</pre>

<p>This command will execute 'command' using a call to CreateProcess(). Unlike <a href="Chapter5.html#5.1.9">!system</a>, it does not use the command line processor, so input/output redirection and commands like 'cd', 'dir' and 'type' can not be used. !execute also ignores the return value of the executed command. Currently, the only known advantage of !execute over <a href="Chapter5.html#5.1.9">!system</a> is that it does not give trouble when the current working directory is specified using UNC.</p>

<p>On POSIX platforms, !execute will use system() just like <a href="Chapter5.html#5.1.9">!system</a>.</p>
<pre>!execute '&quot;%WINDIR%\notepad.exe&quot; &quot;${NSISDIR}\license.txt&quot;'
</pre>
<a name="5.1.8"></a><h3>5.1.8 !packhdr</h3>
<pre>tempfile command
</pre>

<p>This option makes the compiler use an external EXE packer (such as <a href="http://www.un4seen.com/petite/">Petite</a> or <a href="http://upx.sourceforge.net/">UPX</a>) to compress the executable header. Specify a temporary file name (such as &quot;temp.dat&quot;) and a command line (such as &quot;C:\program files\upx\upx -9 temp.dat&quot;) to compress the header.</p>
<pre>!packhdr &quot;%TEMP%\exehead.tmp&quot; '&quot;C:\Program Files\UPX\upx.exe&quot; &quot;%TEMP%\exehead.tmp&quot;'
</pre>
<a name="5.1.9"></a><h3>5.1.9 !system</h3>
<pre>command [compare comparevalue]
</pre>

<p>This command will execute 'command' using a call to system(), and if the return value compared (using 'compare') to 'comparevalue' is false, execution will halt. 'compare' can be '&lt;' or '&gt;' or '&lt;&gt;' or '='.</p>
<pre>!system '&quot;%WINDIR%\notepad.exe&quot; &quot;${NSISDIR}\license.txt&quot;'
!system 'echo !define something &gt; newinclude.nsh'
!include newinclude.nsh
!ifdef something
  !echo &quot;something is defined&quot;
!endif
</pre>
<a name="5.1.10"></a><h3>5.1.10 !warning</h3>
<pre>[message]
</pre>

<p>This command will issue a warning to the script compiler. You can also add a message to this warning.</p>
<pre>!ifdef USE_DANGEROUS_STUFF
  !warning &quot;using dangerous stuff&quot;
!endif
</pre>
<a name="5.1.11"></a><h3>5.1.11 !verbose</h3>
<pre>level | push | pop
</pre>

<p>This command will set the level of verbosity. 4=all, 3=no script, 2=no info, 1=no warnings, 0=none.</p>

<p>Passing push will cause !verbose to push the current verbosity level on a special stack. Passing pop will cause !verbose to pop the current verbosity level from the same stack and use it.</p>
<pre>!verbose push
!verbose 1
!include WinMessages.nsh
!verbose pop
</pre>
<a name="5.2"></a><h2>5.2 Predefines</h2>

<p>You can use these standard predefines to automatically add the build time to the title of development versions, add the date to the version number, etc.</p>
<a name="5.2.1"></a><h3>5.2.1 ${__FILE__}</h3>

<p>Current script name.</p>
<a name="5.2.2"></a><h3>5.2.2 ${__LINE__}</h3>

<p>Current line number.</p>
<a name="5.2.3"></a><h3>5.2.3 ${__DATE__}</h3>

<p>Date when the script started compiling according to the current locale.</p>
<a name="5.2.4"></a><h3>5.2.4 ${__TIME__}</h3>

<p>Time when the script started compiling according to the current locale.</p>
<a name="5.2.5"></a><h3>5.2.5 ${__TIMESTAMP__}</h3>

<p>Date &amp; time of the last modification to the script file according to the current locale.</p>
<a name="5.3"></a><h2>5.3 Read enviroment variables</h2>
<a name="5.3.1"></a><h3>5.3.1 $%envVarName%</h3>

<p>$%envVarName% will be replaced on compile time by the enviroment variable envVarName.</p>
<a name="5.4"></a><h2>5.4 Conditional Compilation</h2>

<p>The compiler maintains a list of defined symbols, which can be defined using !define or the /D command line switch. These defined symbols can be used for conditional compilation (using !ifdef) or for symbol replacement (a simple form of macros). To replace a symbol with its value, use ${SYMBOL} (if SYMBOL is not defined, no translation will occur). The translation is first-come-first-served, meaning if you do:</p>
<pre>!define symbol1 ${symbol2}
</pre>

<p>If symbol2 is defined when that line occurs, it will be replaced. Otherwise, any replacing will occur when ${symbol1} is referenced.</p>

<p>Define/conditional compilation related commands:</p>
<a name="5.4.1"></a><h3>5.4.1 !define</h3>
<pre>[/date] gflag [value]
</pre>

<p>This command will add 'gflag' to the global define list. This will have a similar effect as using the /D switch on the command line (only the define only becomes effective after the !define command).</p>

<p>If <em>/date</em> is used, <em>value</em> will be passed into strftime and the result will be used as the value of <em>gflag</em>. strftime converts special symbols into certain parts of the current time or date. For example, %H will be converted into the current hour in 24-hour format. For a complete list of available symbols, search for strftime on <a href="http://msdn.microsoft.com/">MSDN</a>. On POSIX, you can get the list by using <code>man strftime</code>.</p>
<pre>!define USE_SOMETHING
!define VERSION 1.2
!define /date NOW &quot;%H:%M:%S %d %b, %Y&quot;
</pre>
<a name="5.4.2"></a><h3>5.4.2 !undef</h3>
<pre>gflag
</pre>

<p>Removes an item from the global define list. Note that ${SYMBOL} where SYMBOL is undefined will be translated to &quot;${SYMBOL}&quot;.</p>
<pre>!define SOMETHING
!undef SOMETHING
</pre>
<a name="5.4.3"></a><h3>5.4.3 !ifdef</h3>
<pre>gflag [bcheck [gflag [...]]]
</pre>

<p>This command, when paired with an !endif command, will tell the compiler whether or not to compile the lines in between the two lines. If gflag is globally defined (using !define or the /D switch), then the contained lines will be compiled. Otherwise, they will be skipped. 'bcheck' can be specified as &amp; (boolean and) or | (boolean or) along with more gflags -- precedence is simple, left to right.</p>
<pre>!define SOMETHING
!ifdef SOMETHING
  !echo &quot;SOMETHING is defined&quot;
!endif
!undef SOMETHING
!ifdef SOMETHING
  !echo &quot;SOMETHING is defined&quot; # will never be printed
!endif
</pre>
<a name="5.4.4"></a><h3>5.4.4 !ifndef</h3>
<pre>gflag [bcheck [gflag [...]]]
</pre>

<p>The opposite of !ifdef. The lines will be compiled when the gflag has not been defined.</p>
<a name="5.4.5"></a><h3>5.4.5 !ifmacrodef</h3>
<pre>gflag [bcheck [gflag [...]]]
</pre>

<p>This command, when paired with an !endif command, will tell the compiler whether or not to compile the lines in between the two lines. If the macro gflag exists, then the contained lines will be compiled. Otherwise, they will be skipped. 'bcheck' can be specified as &amp; (boolean and) or | (boolean or) along with more gflags -- precedence is simple, left to right.</p>
<pre>!macro SomeMacro
!macroend
!ifmacrodef SomeMacro
  !echo &quot;SomeMacro is defined&quot;
!endif
</pre>
<a name="5.4.6"></a><h3>5.4.6 !ifmacrondef</h3>
<pre>gflag [bcheck [gflag [...]]]
</pre>

<p>The opposite of !ifmacrodef. The lines will be compiled when the macro gflag does not exist.</p>
<a name="5.4.7"></a><h3>5.4.7 !else</h3>
<pre>[ifdef|ifndef|ifmacrodef|ifmacrondef [...]]
</pre>

<p>This command allows to easily insert different code when different defines or macros are set. You can create blocks like !ifdef/!else/!endif, !ifdef/!else ifdef/!else/!endif etc.</p>
<pre>!ifdef VERSION
OutFile installer-${VERSION}.exe
!else
OutFile installer.exe
!endif
</pre>
<a name="5.4.8"></a><h3>5.4.8 !endif</h3>

<p>This command closes a block started with !ifdef, !ifndef, !ifmacrodef or !ifmacrondef.</p>
<a name="5.4.9"></a><h3>5.4.9 !insertmacro</h3>
<pre>macro_name [parameter] [...]
</pre>

<p>Inserts the contents of a macro that was created with !macro. If the macro was created with parameters, then you must pass as many parameters to the macro as it requires.</p>
<pre>!macro Print text
  DetailPrint &quot;${text}&quot;
!macroend
!insertmacro Print &quot;some text&quot;
!insertmacro Print &quot;some more text&quot;
</pre>
<a name="5.4.10"></a><h3>5.4.10 !macro</h3>
<pre>macro_name [parameter][...]
</pre>

<p>Creates a macro named 'macro_name'. All lines between the !macro and the !macroend will be saved. To insert the macro later on, use !insertmacro. !macro definitions can have one or more parameters defined. The parameters may be accessed the same way a !define would (e.g. ${PARMNAME}) from inside the macro.</p>
<pre>!macro SomeMacro parm1 parm2 parm3
  DetailPrint &quot;${parm1}&quot;
  MessageBox MB_OK &quot;${parm2}&quot;
  File &quot;${parm3}&quot;
!macroend
</pre>
<a name="5.4.11"></a><h3>5.4.11 !macroend</h3>

<p>Ends a macro that was started with !macro.</p>
<p><a href='Chapter4.html'>Previous</a> | <a href='Contents.html'>Contents</a> | <a href='AppendixA.html'>Next</a></p>

<hr />

<address>
</address>
</body>

</html>
